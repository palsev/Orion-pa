"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6833],{42418:function(t,e,n){n.d(e,{B:function(){return S},O:function(){return w}});var r=n(20406),o=n(28526),i=n.n(o),u=n(709),s=n(2784),a=n(18047),l=n(16566),d=n(79779),p=n(68619),c=n(33419),m=n(29150),f=n(91023),D=n(52992),v=n(21699),h=n(6391),A=n.n(h),S=function(t){var e=(0,c.Dv)(v.sV),n=(0,c.Dv)(v.rK),o=(0,c.Dv)(v.tT),l=(0,a.l)(t),h=l.loading,A=l.data,S=(0,c.Dv)(m.xS),w=(0,p.nw)(S,18).sqrt(),O=(0,s.useState)(u.HW),y=O[0],H=O[1],W=(0,s.useState)(u.HW),T=W[0],E=W[1],P=(0,s.useState)(u.HW),b=P[0],g=P[1],I=(0,s.useState)(u.HW),_=I[0],j=I[1],U=(0,D.Z)((function(){if(h||!A)return{depositedEth:u.HW,usdAmount:u.HW};var t=null===A||void 0===A?void 0:A.reduce((function(t,e){return e.type===d.J0.FLASH_DEPOSIT?(t.depositedEth=t.depositedEth.plus(e.ethAmount),t.lpAmount=t.lpAmount.plus(e.lpAmount),t.usdAmount=t.usdAmount.plus(e.ethUsdValue)):e.type===d.J0.FLASH_WITHDRAW&&(t.depositedEth=t.depositedEth.minus(e.ethAmount),t.lpAmount=t.lpAmount.minus(e.lpAmount),t.usdAmount=t.usdAmount.minus(e.ethUsdValue)),t.lpAmount.isZero()&&(t.depositedEth=u.HW,t.usdAmount=u.HW),t}),{depositedEth:u.HW,lpAmount:u.HW,usdAmount:u.HW});return{depositedEth:t.depositedEth,usdAmount:t.usdAmount}}),[A,h]),C=U.depositedEth,L=U.usdAmount,x=(0,f.Z)((0,r.Z)(i().mark((function t(){var e,n;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=o.times(w),n=e.minus(L),H(o),E(e),g(n),j(n.div(L).times(100));case 6:case"end":return t.stop()}}),t)}))),[o,L,w]);return(0,s.useEffect)((function(){e||h||n||x()}),[x,e,n,h]),{depositedEth:C,depositedUsd:L,minCurrentEth:y,minCurrentUsd:T,minPnL:_,minPnlUsd:b,loading:e||h}},w=function(t){var e,n=(0,c.Dv)(v.WZ),o=(0,s.useState)(!1),a=o[0],h=o[1],S=(0,c.Dv)(v.Ny),w=(0,c.Dv)(v.Qj),O=(0,s.useState)(void 0),y=O[0],H=O[1],W=(0,c.Dv)(v._R),T=(0,l.A)(t),E=T.loading,P=T.data,b=T.startPolling,g=T.stopPolling,I=(0,c.Dv)(m.xS),_=(0,p.nw)(I,18).sqrt(),j=(0,s.useState)(u.HW),U=j[0],C=j[1],L=(0,s.useState)(u.HW),x=L[0],R=L[1],F=(0,s.useState)(u.HW),Z=F[0],k=F[1],N=(0,s.useState)(u.HW),V=N[0],q=N[1],B=(0,D.Z)((function(){if(console.log(P,"Crab"),E||!P||0===P.length)return{remainingDepositUsd:u.HW,remainingDepositEth:u.HW};var t=null===P||void 0===P?void 0:P.reduce((function(t,e){return e.type===d.nf.FLASH_DEPOSIT||e.type===d.nf.DEPOSIT||e.type===d.nf.DEPOSIT_V1||e.type===d.J0.DEPOSIT||e.type===d.nf.OTC_DEPOSIT?(t.totalSharesDeposited=t.totalSharesDeposited.plus(e.lpAmount),t.totalUSDDeposit=t.totalUSDDeposit.plus(e.ethUsdValue),t.totalETHDeposit=t.totalETHDeposit.plus(e.ethAmount)):e.type!==d.nf.FLASH_WITHDRAW&&e.type!==d.nf.WITHDRAW&&e.type!==d.nf.OTC_WITHDRAW||(t.totalSharesWithdrawn=t.totalSharesWithdrawn.plus(e.lpAmount)),t}),{totalSharesDeposited:u.HW,totalSharesWithdrawn:u.HW,totalUSDDeposit:u.HW,totalETHDeposit:u.HW}),e=t.totalSharesDeposited,n=t.totalSharesWithdrawn,r=t.totalUSDDeposit,o=t.totalETHDeposit,i=new(A())(1).minus(n.div(e));return{remainingDepositUsd:i.multipliedBy(r),remainingDepositEth:i.multipliedBy(o)}}),[P,E]),J=B.remainingDepositEth,$=B.remainingDepositUsd,K=(0,f.Z)((0,r.Z)(i().mark((function t(){var e,n,r;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=w.plus(W),n=e.times(_),r=n.minus($),C(e),R(n),k(r),q(r.div($).times(100));case 7:case"end":return t.stop()}}),t)}))),[w,W,$,_]);(0,s.useEffect)((function(){n||E||S||a||K()}),[K,n,S,E,a]),(0,s.useEffect)((function(){y||g(),(null===P||void 0===P?void 0:P.find((function(t){return t.id.toLowerCase()===y})))&&(h(!1),H(void 0))}),[h,g,P,y]);var M=(0,f.Z)((function(t){h(!0),H(t),b(500)}),[h,b]);return{depositedEth:J,depositedUsd:$,minCurrentEth:U,minCurrentUsd:x,minPnL:V,minPnlUsd:Z,loading:n||E||a,pollForNewTx:M,firstDepositTimestamp:null===P||void 0===P||null===(e=P[0])||void 0===e?void 0:e.timestamp}}},18047:function(t,e,n){n.d(e,{l:function(){return h}});var r,o=n(95235),i=n(36268),u=n(7328),s=(0,n(22841).Ps)(r||(r=(0,u.Z)(['\n  query userCrabTxes($ownerId: ID!, $orderDirection: String!) {\n    crabStrategyTxes(\n      orderBy: timestamp\n      orderDirection: $orderDirection\n      where: { owner: $ownerId, type_in: ["FLASH_DEPOSIT", "FLASH_WITHDRAW"] }\n    ) {\n      id\n      type\n      ethAmount\n      wSqueethAmount\n      lpAmount\n      timestamp\n    }\n  }\n']))),a=n(68619),l=n(709),d=n(78680),p=n(79779),c=n(53633),m=n(31257),f=n(33419);function D(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function v(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?D(Object(n),!0).forEach((function(e){(0,o.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):D(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var h=function(t,e){var n=(0,f.Dv)(m.vH),r=(0,c.k)().getUsdAmt,o=(0,i.a)(s,{fetchPolicy:"cache-and-network",client:d.Y[n],variables:{ownerId:null!==t&&void 0!==t?t:"",orderDirection:e?"desc":"asc"}}),u=o.data,D=o.loading,h=o.startPolling,A=o.stopPolling;return{loading:D,data:null===u||void 0===u?void 0:u.crabStrategyTxes.map((function(t){var e,n=(0,a.nw)(t.ethAmount,l.RN),o=r(n,t.timestamp),i=(0,a.nw)(t.lpAmount,l.RN),u=(0,a.nw)(t.wSqueethAmount,l.xM);return v(v({},t),{},{ethAmount:n,lpAmount:i,oSqueethAmount:u,ethUsdValue:o,txTitle:(e=t.type,e===p.J0.DEPOSIT?"Deposit":e===p.J0.WITHDRAW?"Withdraw":e===p.J0.FLASH_DEPOSIT?"Flash Deposit":e===p.J0.FLASH_WITHDRAW?"Flash Withdraw":e===p.J0.HEDGE_ON_UNISWAP?"Hedge on Uniswap":e===p.J0.HEDGE?"Hedge":void 0)})})),startPolling:h,stopPolling:A}}},16566:function(t,e,n){n.d(e,{A:function(){return y}});var r,o=n(95235),i=n(36268),u=n(7328),s=(0,n(22841).Ps)(r||(r=(0,u.Z)(['\n  query userCrabV2Txes($ownerId: ID!, $orderDirection: String!) {\n    crabUserTxes(\n      orderBy: timestamp\n      orderDirection: $orderDirection\n      where: {\n        owner: $ownerId\n        type_in: ["FLASH_DEPOSIT", "FLASH_WITHDRAW", "DEPOSIT", "WITHDRAW", "DEPOSIT_V1", "OTC_DEPOSIT", "OTC_WITHDRAW"]\n      }\n    ) {\n      id\n      type\n      ethAmount\n      wSqueethAmount\n      lpAmount\n      timestamp\n      excessEth\n      erc20Token\n      erc20Amount\n      transaction\n    }\n  }\n']))),a=n(68619),l=n(709),d=n(78680),p=n(79779),c=n(31257),m=n(33419),f=n(52992),D=n(6391),v=n.n(D),h=n(42277),A=n(13416),S=n(2784);function w(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function O(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?w(Object(n),!0).forEach((function(e){(0,o.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var y=function(t,e){var n=(0,m.Dv)(c.vH),r=(0,m.Dv)(h.pK).usdc,o=(0,S.useState)(),u=o[0],D=o[1],w=(0,S.useState)(!1),y=w[0],H=w[1],W=(0,i.a)(s,{fetchPolicy:"cache-and-network",client:d.Y[n],variables:{ownerId:null!==t&&void 0!==t?t:"",orderDirection:e?"desc":"asc"}}),T=W.data,E=W.loading,P=W.startPolling,b=W.stopPolling,g=(W.error,(0,f.Z)((function(){var t;return null!==(t=null===T||void 0===T?void 0:T.crabUserTxes)&&void 0!==t?t:[]}),[T]));(0,S.useEffect)((function(){var t=g.map((function(t){return 1e3*t.timestamp}));D(void 0),H(!0),(0,A.Zt)(t).then((function(t){D(null!==t&&void 0!==t?t:void 0)})).finally((function(){H(!1)}))}),[g]);var I=(0,S.useMemo)((function(){return u&&g.every((function(t){return!!u[1e3*Number(t.timestamp)]}))}),[g,u]);return{loading:E||y,data:(0,f.Z)((function(){return I?g.map((function(t){var e,n,o=(0,a.nw)(t.ethAmount,l.RN),i=o.multipliedBy(u[1e3*Number(t.timestamp)]);if(t.type===p.nf.DEPOSIT_V1){var s=new(v())(l.zF),d=new(v())(l.we);i=(o=s.minus(d.times(l.KR)).times((0,a.nw)(t.lpAmount,l.RN)).div(l.Tx)).times(l.CN)}t.type===p.nf.FLASH_WITHDRAW&&r.toLowerCase()===(null===(e=t.erc20Token)||void 0===e?void 0:e.toLowerCase())?i=(0,a.nw)(t.erc20Amount,l.p8):t.type===p.nf.FLASH_DEPOSIT&&r.toLowerCase()===(null===(n=t.erc20Token)||void 0===n?void 0:n.toLowerCase())&&(i=(0,a.nw)(t.erc20Amount,l.p8).minus(u?(0,a.nw)(t.excessEth,18).multipliedBy(u[1e3*Number(t.timestamp)]):0)),t.type!==p.nf.OTC_DEPOSIT&&t.type!==p.nf.OTC_WITHDRAW||(i=(0,a.nw)(t.erc20Amount,l.p8).minus((0,a.nw)(t.ethAmount,18).multipliedBy(u?u[1e3*Number(t.timestamp)]:0)),o=(0,a.nw)(t.erc20Amount,l.p8).div((0,a.nw)(l.cQ,18).multipliedBy(u?u[1e3*Number(t.timestamp)]:0)));var c,m=(0,a.nw)(t.lpAmount,l.RN),f=(0,a.nw)(t.wSqueethAmount,l.xM);return O(O({},t),{},{ethAmount:o,lpAmount:m,oSqueethAmount:f,ethUsdValue:i,txTitle:(c=t.type,c===p.nf.DEPOSIT?"Deposit":c===p.nf.WITHDRAW?"Withdraw":c===p.nf.FLASH_DEPOSIT?"Flash Deposit":c===p.nf.FLASH_WITHDRAW?"Flash Withdraw":c===p.nf.DEPOSIT_V1?"Deposit v1 shares":void 0)})})):[]}),[g,r,u,I]),startPolling:P,stopPolling:b}}},36200:function(t,e,n){n.d(e,{K3:function(){return f},rL:function(){return m}});var r=n(8529),o=n(20406),i=n(28526),u=n.n(i),s=(n(91023),n(68619)),a=n(33419),l=n(2784),d=n(31199),p=n(31257),c=(n(48125),n(72902)),m=function(){var t=f();(0,l.useEffect)((function(){t()}),[t])},f=function(){var t=(0,a.Dv)(p.iu),e=(0,a.Dv)(d.c4),n=(0,a.b9)(c.b2);return(0,l.useCallback)((0,o.Z)(u().mark((function o(){var i,a,l,d;return u().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(null==t){o.next=8;break}return i=null===e||void 0===e?void 0:e.methods.sharesDeposited(t).call(),o.next=4,Promise.all([i]);case 4:a=o.sent,l=(0,r.Z)(a,1),d=l[0],n((0,s.nw)(d,18));case 8:case"end":return o.stop()}}),o)}))),[t,null===e||void 0===e?void 0:e.methods,n])}}}]);
//# sourceMappingURL=6833-4d2ae04217fd3f3c.js.map