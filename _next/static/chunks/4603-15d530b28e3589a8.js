"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4603],{8234:function(t,e,n){n.d(e,{Cd:function(){return O},DQ:function(){return P},GO:function(){return Z},Ky:function(){return C},Q:function(){return m},QI:function(){return y},Q_:function(){return E},SR:function(){return S},S_:function(){return W},U:function(){return j},XV:function(){return h},YY:function(){return v},Yg:function(){return p},_Q:function(){return D},_m:function(){return k},dE:function(){return N},dQ:function(){return b},du:function(){return d},kc:function(){return I},ln:function(){return w},m5:function(){return x},ro:function(){return _},sm:function(){return f},t7:function(){return H},tj:function(){return l},ui:function(){return R},v1:function(){return g}});n(28526);var r=n(709),u=n(29150),c=n(21699),o=n(68619),a=(n(85317),n(6391)),i=n.n(a),s=n(33419),l=(n(82066),(0,s.cn)(3),(0,s.cn)(new(i())(0))),f=(0,s.cn)(new(i())(0)),v=(0,s.cn)(new(i())(0)),p=(0,s.cn)(new(i())(0)),d=(0,s.cn)(new(i())(0)),m=(0,s.cn)(new(i())(0)),w=(0,s.cn)(new(i())(0)),b=(0,s.cn)(new(i())(0)),h=(0,s.cn)(new(i())(0)),g=(0,s.cn)(new(i())(0)),y=(0,s.cn)(new(i())(0)),D=(0,s.cn)(new(i())(0)),x=(0,s.cn)(new(i())(0)),E=(0,s.cn)(new(i())(0)),O=(0,s.cn)(new(i())(0)),k=(0,s.cn)(0),P=(0,s.cn)(!1),S=(0,s.cn)(!1),R=(0,s.cn)(!1),Z=(0,s.cn)(new(i())(.05)),j=(0,s.cn)(new(i())(.1)),N=(0,s.cn)(r.HW),I=(0,s.cn)((function(t){var e=(0,o.nw)(t(u.xS),r.xM).sqrt(),n=t(Z),a=t(j),i=t(N),s=t(w).times(e),f=t(l).times((0,o.nw)(t(c.uI),18)),v=i.times(Math.exp(n.div(182.5).toNumber())).minus(i),p=s.times(Math.exp(a.div(182.5).toNumber())).minus(s).minus(v).div(f).div(2),d=t(u.e1);return p.plus(d).toNumber()})),W=((0,s.cn)((function(t){var e=t(I);return e<0?0:Math.sqrt(365*e)/Math.sqrt(182.5)})),(0,s.cn)(0)),_=((0,s.cn)(new Date(r.Nd)),(0,s.cn)(new Date),(0,s.cn)(new(i())(0))),C=(0,s.cn)(new(i())(0)),H=(0,s.cn)(!1)},54603:function(t,e,n){n.d(e,{oy:function(){return $},aV:function(){return X},k8:function(){return L},vh:function(){return Y}});var r,u=n(95235),c=n(8529),o=n(20406),a=n(28526),i=n.n(a),s=n(36268),l=n(709),f=n(53818),v=n(41436),p=n(91023),d=n(52992),m=(n(13416),n(88236)),w=n(7328),b=(0,n(22841).Ps)(r||(r=(0,w.Z)(["\n  query strategyQuery($strategyId: ID!) {\n    strategy(id: $strategyId) {\n      id\n      vaultId\n      lastHedgeTx\n      lastHedgeTimestamp\n    }\n  }\n"]))),h=n(31199),g=n(29150),y=n(21699),D=n(42277),x=n(80208),E=n(74156),O=n(31257),k=n(48125),P=n(73381),S=n(78680),R=n(68619),Z=n(6391),j=n.n(Z);function N(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function I(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?N(Object(n),!0).forEach((function(e){(0,u.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var W=function(){var t=(0,o.Z)(i().mark((function t(e,n,r,u,c,o){var a,s,l;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a={tokenIn:n,tokenOut:r,amount:u.toFixed(0),fee:c,sqrtPriceLimitX96:0},t.next=3,e.methods.quoteExactOutputSingle(a).call();case 3:return s=t.sent,l=new(j())(s.amountIn).times(100+o).div(100).toFixed(0),t.abrupt("return",I(I({},s),{},{maxAmountIn:l}));case 6:case"end":return t.stop()}}),t)})));return function(e,n,r,u,c,o){return t.apply(this,arguments)}}(),_=n(33419),C=n(2784),H=n(82066),A=n(87438),T=n(8234),F=function(){var t=(0,o.Z)(i().mark((function t(e,n,r,u,c){var o,a,s;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=e.div(r),a=o.times(u),s=a.times(n.shortAmount).div(c),t.abrupt("return",{crabToRedeem:a,wPowerPerpToRedeem:s});case 4:case"end":return t.stop()}}),t)})));return function(e,n,r,u,c){return t.apply(this,arguments)}}(),G=function(t){return t.div(new(j())(10).pow(27))};function q(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Q(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?q(Object(n),!0).forEach((function(e){(0,u.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):q(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Y=function(){var t,e=K(),n=M(),r=(0,_.b9)(T.S_),u=(0,_.Dv)(D.pK).auctionBull,c=(0,_.Dv)(O.vH),o=(0,s.a)(b,{variables:{strategyId:u},fetchPolicy:"cache-and-network",client:S.Y[c]}),a=o.data,i=o.loading;(0,C.useEffect)((function(){var t;i||r(null===a||void 0===a||null===(t=a.strategy)||void 0===t?void 0:t.lastHedgeTimestamp)}),[null===a||void 0===a||null===(t=a.strategy)||void 0===t?void 0:t.lastHedgeTimestamp,i,r]),(0,C.useEffect)((function(){e()}),[e]),(0,C.useEffect)((function(){n()}),[n])},K=function(){var t=(0,_.Dv)(h.Ge),e=(0,_.Dv)(h.KD),n=(0,_.Dv)(h.cH),r=(0,_.Dv)(h.EI),u=(0,_.b9)(T.tj),a=(0,_.b9)(T.sm),s=(0,_.b9)(T.YY),f=(0,_.b9)(T.Yg),v=(0,_.b9)(T.Q),d=(0,_.b9)(T.ln),m=(0,_.b9)(T.XV),w=(0,_.b9)(T.dQ),b=(0,_.b9)(T.GO),g=(0,_.b9)(T.U),y=(0,_.b9)(T.dE),x=(0,_.Dv)(D.pK),E=x.bullStrategy,O=x.weth,k=x.usdc,P=(0,A.Z)();return(0,p.Z)((0,o.Z)(i().mark((function o(){var p,h,D,x,S,Z,N,I,W,_,C,H,A,T,F,q,Q,Y,K,M,L,U;return i().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(t&&e&&n&&r){o.next=2;break}return o.abrupt("return",null);case 2:return o.prev=2,p=t.methods.getCrabBalance().call(),h=t.methods.totalSupply().call(),D=t.methods.calcWethToWithdraw(l.cQ.toString()).call(),x=t.methods.calcUsdcToRepay(l.cQ.toString()).call(),S=t.methods.strategyCap().call(),Z=e.methods.balanceOfUnderlying(E).call(),N=n.methods.getCurrentDeltaAndCollatRatio().call(),I=r.methods.interestRates(O).call(),W=r.methods.interestRates(k).call(),_=r.methods.getDTokenBalance(k,E).call(),o.next=15,Promise.all([p,h,D,x,S,Z,N,I,W,_]);case 15:if(C=o.sent,H=(0,c.Z)(C,10),A=H[0],T=H[1],F=H[2],q=H[3],Q=H[4],Y=H[5],K=H[6],M=H[7],L=H[8],U=H[9],P()){o.next=29;break}return o.abrupt("return",null);case 29:u((0,R.nw)(A,l.RN)),a((0,R.nw)(T,l.RN)),s((0,R.nw)(F,l.RN)),f((0,R.nw)(q,l.p8)),v((0,R.nw)(Q,l.RN)),d((0,R.nw)(Y,l.RN)),w((0,R.nw)(K[0],l.RN)),m((0,R.nw)(K[1],l.RN)),b(G(new(j())(L[1]))),g(G(new(j())(M[2]))),y((0,R.nw)(U,l.p8)),o.next=45;break;case 42:o.prev=42,o.t0=o.catch(2),console.error(o.t0);case 45:case"end":return o.stop()}}),o,null,[[2,42]])}))),[t,e,n,r,E,O,k,P])},M=function(){var t=(0,_.Dv)(D.pK).bullStrategy,e=(0,f.m)(t).value,n=(0,_.Dv)(T.YY),r=(0,_.Dv)(T.Yg),u=(0,_.Dv)(g.xS),c=(0,R.nw)(u,18).sqrt(),a=(0,_.Dv)(T.tj),s=(0,_.Dv)(T.sm),l=(0,_.Dv)(y.lM),v=(0,_.Dv)(y.H7),d=(0,E.Ni)(),m=(0,_.b9)(T.v1),w=(0,_.b9)(T.QI),b=(0,_.b9)(T.du),h=(0,_.b9)(T.DQ),x=(0,A.Z)();return(0,p.Z)((0,o.Z)(i().mark((function t(){var u,o,f,p,g,y,D;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(v&&!n.isZero()&&!r.isZero()&&x()){t.next=2;break}return t.abrupt("return",null);case 2:if(u=e.times(n.minus(r.div(c))).div(s),o=e.times(a).div(s),f=o.times(v.collateralAmount).div(l),p=o.times(v.shortAmount).div(l),g=d(p),y=f.minus(g),D=y.plus(u),x()){t.next=11;break}return t.abrupt("return",null);case 11:m(new(j())(D.toFixed(18))),w(D.times(c)),b(D.div(e)),h(!0);case 15:case"end":return t.stop()}}),t)}))),[a,e,s,l,v,c,r,n,x])},L=function(){var t=U(),e=B();(0,C.useEffect)((function(){t()}),[t]),(0,C.useEffect)((function(){e()}),[e])},U=function(){var t=(0,_.Dv)(h.Ge),e=(0,_.Dv)(h.w8),n=(0,_.b9)(T.tj),r=(0,_.b9)(T.sm),u=(0,A.Z)();return(0,p.Z)((0,o.Z)(i().mark((function o(){var a,s,f,v,p,d,m,w;return i().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(t&&e){o.next=2;break}return o.abrupt("return",null);case 2:return o.prev=2,a=t.methods.getCrabBalance().call(),s=t.methods.totalSupply().call(),f=e.methods.redeemedZenBullAmountForCrabWithdrawal().call(),o.next=8,Promise.all([a,s,f]);case 8:if(v=o.sent,p=(0,c.Z)(v,3),d=p[0],m=p[1],w=p[2],u()){o.next=15;break}return o.abrupt("return",null);case 15:n((0,R.nw)(d,l.RN)),r((0,R.nw)(m,l.RN).minus((0,R.nw)(w,l.RN))),o.next=22;break;case 19:o.prev=19,o.t0=o.catch(2),console.error(o.t0);case 22:case"end":return o.stop()}}),o,null,[[2,19]])}))),[t,e,u])},B=function(){var t=(0,_.Dv)(D.pK).bullStrategy,e=(0,_.Dv)(T.tj),n=(0,_.Dv)(T.sm),r=(0,_.Dv)(y.lM),u=(0,_.Dv)(y.H7),c=(0,_.Dv)(g.xS),a=(0,_.b9)(T.ro),s=(0,_.b9)(T.Ky),v=(0,_.b9)(T.t7),d=(0,E.Ni)(),m=(0,A.Z)(),w=(0,f.m)(t).value,b=(0,R.nw)(c,18).sqrt();return(0,p.Z)((0,o.Z)(i().mark((function t(){var c,o,f,p,b,h,g;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(u&&m()){t.next=2;break}return t.abrupt("return",null);case 2:c=n.isZero()?l.HW:w.div(n),o=c.times(e),f=o.times(u.collateralAmount).div(r),p=o.times(u.shortAmount).div(r),b=d(p),h=f.minus(b),g=h,a(new(j())(g.toFixed(18))),s(g.div(w)),v(!0);case 12:case"end":return t.stop()}}),t)}))),[e,w,n,r,u,b,m])},X=function(){var t=(0,_.Dv)(y.H7),e=(0,_.Dv)(T.sm),n=(0,_.Dv)(T.tj),r=(0,_.Dv)(y.lM),u=(0,_.Dv)(h.xS),c=(0,_.Dv)(D.pK),a=c.oSqueeth,s=c.weth,f=(0,_.Dv)(y.ib),v=(0,_.Dv)(x.xo),p=(0,_.Dv)(O.vH),m=(0,H.useQueryClient)(),w={maxEthForWPowerPerp:l.HW,ethInForOsqth:l.HW,osqthOut:l.HW,wPowerPerpPoolFee:l.E4,priceImpact:0},b=function(){var c=(0,o.Z)(i().mark((function c(o){var p,d,m,b,h,g,y,D,x;return i().wrap((function(c){for(;;)switch(c.prev=c.next){case 0:if(t&&u){c.next=2;break}return c.abrupt("return",w);case 2:return c.next=4,F(o,t,e,n,r);case 4:return p=c.sent,d=p.wPowerPerpToRedeem,c.next=8,W(u,s,a,(0,R.KU)(d,18),l.E4,f);case 8:return m=c.sent,b=m.maxAmountIn,h=m.amountIn,g=(0,R.nw)(b,18),y=(0,R.nw)(h,18),D=d.times(v),x=100*(y.div(D).toNumber()-1),c.abrupt("return",Q(Q({},w),{},{maxEthForWPowerPerp:g,ethInForOsqth:y,osqthOut:d,priceImpact:x}));case 17:case"end":return c.stop()}}),c)})));return function(t){return c.apply(this,arguments)}}(),g=(0,d.Z)((function(){return"getEmergencyWithdrawParams-".concat(p,"-").concat(r.toString(),"-").concat(n.toString(),"-").concat(e.toString(),"-").concat(null===t||void 0===t?void 0:t.collateralAmount.toString(),"-").concat(v.toString(),"-").concat(f.toString())}),[p,r,n,e,null===t||void 0===t?void 0:t.collateralAmount,v,f]),E=function(){var t=(0,o.Z)(i().mark((function t(e){var n;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,m.fetchQuery({queryKey:"".concat(g,"-").concat(e.toString()),queryFn:function(){return b(e)},staleTime:6e4});case 3:return n=t.sent,t.abrupt("return",n);case 7:return t.prev=7,t.t0=t.catch(0),console.log(t.t0),t.abrupt("return",w);case 11:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e){return t.apply(this,arguments)}}();return E},$=function(){var t=(0,_.Dv)(h.w8),e=(0,_.Dv)(O.iu),n=(0,_.Dv)(D.pK).bullEmergencyWithdraw,r=(0,v.Z)().track,u=(0,k.B0)(),c=(0,m.ZP)((0,m.Js)("Hi, I am having trouble withdrawing from bull.","withdraw-bull-recovery")).show,a=function(){var a=(0,o.Z)(i().mark((function o(a,s,f,v){var p,d,m,w,b;return i().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(t){o.next=2;break}return o.abrupt("return");case 2:return r(P.X$.EMERGENCY_WITHDRAW_BULL_CLICK,f),o.prev=3,m=(0,R.KU)(a,18).toFixed(0),w=(0,R.KU)(s,18).toFixed(0),o.prev=6,o.next=9,t.methods.emergencyWithdrawEthFromCrab(m,w).estimateGas({to:n,from:e});case 9:if(p=o.sent,console.log("gasEstimate for bullEmergencyWithdraw",p),0!==p){o.next=13;break}throw new Error("WRONG_GAS_ESTIMATE");case 13:o.next=21;break;case 15:throw o.prev=15,o.t0=o.catch(6),console.error("gas estimate error: ",o.t0),r(P.X$.EMERGENCY_WITHDRAW_BULL_WRONG_GAS),alert("Error occurred, please refresh and try again"),o.t0;case 21:return d=Number((1.2*p).toFixed(0)),o.next=24,u(t.methods.emergencyWithdrawEthFromCrab(m,w).send({from:e,gas:p?Number((1.2*p).toFixed(0)):void 0}),v);case 24:r(P.X$.EMERGENCY_WITHDRAW_BULL_SUCCESS,Q({},f?Q(Q({},f),{},{gas:d}):{})),o.next=34;break;case 27:o.prev=27,o.t1=o.catch(3),b=Q(Q({},null!==f&&void 0!==f?f:{}),{},{gas:d}),(null===o.t1||void 0===o.t1?void 0:o.t1.code)===l.dG&&r(P.X$.EMERGENCY_WITHDRAW_BULL_REVERT,b),(null===o.t1||void 0===o.t1?void 0:o.t1.code)!==l.dG&&c(),r(P.X$.EMERGENCY_WITHDRAW_BULL_FAILED,Q({code:null===o.t1||void 0===o.t1?void 0:o.t1.code,message:null===o.t1||void 0===o.t1?void 0:o.t1.message},b)),console.log(o.t1);case 34:case"end":return o.stop()}}),o,null,[[3,27],[6,15]])})));return function(t,e,n,r){return a.apply(this,arguments)}}();return a}}}]);
//# sourceMappingURL=4603-15d530b28e3589a8.js.map